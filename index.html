<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slide Deck Builder - Web Tools</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- PptxGenJS -->
    <script src="https://cdn.jsdelivr.net/gh/gitbrent/pptxgenjs@3.12.0/dist/pptxgen.bundle.js"></script>
    <!-- FontAwesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #f3f4f6; }
        .drop-zone { transition: all 0.3s ease; }
        .drop-zone.dragover { background-color: #e0e7ff; border-color: #6366f1; transform: scale(1.01); }
        .card-img { height: 160px; object-fit: cover; width: 100%; }
        /* Custom scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">

    <!-- Header -->
    <header class="bg-white border-b border-gray-200 p-4 flex justify-between items-center shadow-sm z-10">
        <div class="flex items-center gap-3">
            <div class="bg-indigo-600 text-white p-2 rounded-lg">
                <i class="fas fa-layer-group"></i>
            </div>
            <div>
                <h1 class="text-xl font-bold text-gray-800">Slide Deck Builder</h1>
                <p class="text-xs text-gray-500">Part of Web Tools</p>
            </div>
        </div>
        <div class="flex gap-3">
             <button onclick="sortFiles()" class="px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                <i class="fas fa-sort-alpha-down mr-2"></i> Sort by Name
            </button>
            <button onclick="clearAll()" class="px-4 py-2 text-sm font-medium text-red-600 bg-white border border-red-200 rounded-lg hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500">
                <i class="fas fa-trash-alt mr-2"></i> Clear
            </button>
            <button onclick="generatePPTX()" id="downloadBtn" class="px-5 py-2 text-sm font-bold text-white bg-indigo-600 rounded-lg hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 shadow-md transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                <i class="fas fa-file-powerpoint mr-2"></i> Export to PowerPoint
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-y-auto p-6 relative">
        
        <!-- Drop Zone -->
        <div id="dropZone" class="drop-zone border-2 border-dashed border-gray-300 rounded-xl bg-white p-12 text-center cursor-pointer mb-8 hover:border-indigo-400">
            <input type="file" id="fileInput" multiple accept="image/*" class="hidden">
            <div class="pointer-events-none">
                <i class="fas fa-cloud-upload-alt text-5xl text-indigo-200 mb-4"></i>
                <p class="text-lg font-medium text-gray-700">Drag & Drop your slide images here</p>
                <p class="text-sm text-gray-500 mt-1">or click to browse files</p>
            </div>
        </div>

        <!-- Gallery Grid -->
        <div id="gallery" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6 pb-20">
            <!-- Items will be injected here -->
        </div>

        <!-- Empty State (Hidden by default) -->
        <div id="emptyState" class="hidden text-center mt-10">
            <p class="text-gray-400">No images added yet.</p>
        </div>

    </main>
    
    <!-- Footer with GitHub Link -->
    <footer class="bg-white border-t border-gray-200 p-4 text-center z-10">
        <a href="https://github.com/notsaqlain/web-tools" target="_blank" class="text-gray-600 hover:text-indigo-600 font-medium inline-flex items-center gap-2 transition-colors">
            <i class="fab fa-github text-xl"></i>
            <span>View Source on GitHub</span>
        </a>
    </footer>

    <!-- Status Toast -->
    <div id="toast" class="fixed bottom-20 right-5 bg-gray-800 text-white px-6 py-3 rounded-lg shadow-lg transform translate-y-20 transition-transform duration-300 flex items-center gap-3 z-50">
        <i class="fas fa-info-circle text-indigo-400"></i>
        <span id="toastMsg">Notification</span>
    </div>

    <!-- Loading Overlay -->
    <div id="loader" class="fixed inset-0 bg-white/80 backdrop-blur-sm flex flex-col items-center justify-center z-50 hidden">
        <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-indigo-600 mb-4"></div>
        <p class="text-lg font-semibold text-gray-700">Generating Presentation...</p>
        <p class="text-sm text-gray-500">Processing images. Please wait.</p>
    </div>

    <script>
        // State
        let filesData = []; // Array of { file: File, id: string, name: string, url: string }
        
        // DOM Elements
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');
        const gallery = document.getElementById('gallery');
        const downloadBtn = document.getElementById('downloadBtn');
        const loader = document.getElementById('loader');
        const toast = document.getElementById('toast');
        const toastMsg = document.getElementById('toastMsg');

        // Initialization
        updateUI();

        // Event Listeners
        dropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        
        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            dropZone.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            dropZone.addEventListener(eventName, unhighlight, false);
        });

        function highlight() { dropZone.classList.add('dragover'); }
        function unhighlight() { dropZone.classList.remove('dragover'); }

        dropZone.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;
            handleFiles(files);
        }

        function handleFileSelect(e) {
            const files = e.target.files;
            handleFiles(files);
            // Reset input so same files can be selected again if needed
            fileInput.value = ''; 
        }

        function handleFiles(files) {
            const newFiles = Array.from(files).filter(file => file.type.startsWith('image/'));
            
            if (newFiles.length === 0) return;

            newFiles.forEach(file => {
                filesData.push({
                    file: file,
                    id: Math.random().toString(36).substr(2, 9),
                    name: file.name,
                    url: URL.createObjectURL(file)
                });
            });

            // Auto-sort on drop if it looks like a sequence
            sortFiles(false); // pass false to suppress toast on auto-sort
            renderGallery();
            updateUI();
            
            if (newFiles.length > 0) {
                showToast(`Added ${newFiles.length} slide(s)`);
            }
        }

        // Natural Sort Algorithm for filenames like "slide_1", "slide_10"
        function naturalCompare(a, b) {
            return a.name.localeCompare(b.name, undefined, { numeric: true, sensitivity: 'base' });
        }

        function sortFiles(showNotification = true) {
            filesData.sort(naturalCompare);
            renderGallery();
            if (showNotification) showToast("Sorted slides by filename");
        }

        function removeFile(id) {
            filesData = filesData.filter(f => f.id !== id);
            renderGallery();
            updateUI();
        }

        function clearAll() {
            if(confirm("Are you sure you want to remove all slides?")) {
                filesData = [];
                renderGallery();
                updateUI();
                showToast("All slides removed");
            }
        }

        function moveLeft(index) {
            if (index > 0) {
                [filesData[index], filesData[index - 1]] = [filesData[index - 1], filesData[index]];
                renderGallery();
            }
        }

        function moveRight(index) {
            if (index < filesData.length - 1) {
                [filesData[index], filesData[index + 1]] = [filesData[index + 1], filesData[index]];
                renderGallery();
            }
        }

        function renderGallery() {
            gallery.innerHTML = '';
            filesData.forEach((item, index) => {
                const card = document.createElement('div');
                card.className = "bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden hover:shadow-md transition-shadow group relative";
                
                // Slide Number Badge
                const badge = `<div class="absolute top-2 left-2 bg-gray-900/70 text-white text-xs font-bold px-2 py-1 rounded backdrop-blur-sm z-10">Slide ${index + 1}</div>`;
                
                // Delete Button
                const deleteBtn = `<button onclick="removeFile('${item.id}')" class="absolute top-2 right-2 bg-red-500 text-white p-1.5 rounded-full shadow-sm opacity-0 group-hover:opacity-100 transition-opacity hover:bg-red-600 focus:outline-none" title="Remove"><i class="fas fa-times text-xs w-3 h-3 flex items-center justify-center"></i></button>`;

                // Move Controls
                const moveControls = `
                    <div class="absolute bottom-2 right-2 flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="moveLeft(${index})" class="bg-white/90 text-gray-700 hover:text-indigo-600 p-1.5 rounded shadow-sm text-xs ${index === 0 ? 'hidden' : ''}" title="Move Backward"><i class="fas fa-chevron-left"></i></button>
                        <button onclick="moveRight(${index})" class="bg-white/90 text-gray-700 hover:text-indigo-600 p-1.5 rounded shadow-sm text-xs ${index === filesData.length - 1 ? 'hidden' : ''}" title="Move Forward"><i class="fas fa-chevron-right"></i></button>
                    </div>
                `;

                card.innerHTML = `
                    ${badge}
                    ${deleteBtn}
                    <div class="relative">
                        <img src="${item.url}" class="card-img bg-gray-100" alt="${item.name}">
                        ${moveControls}
                    </div>
                    <div class="p-3">
                        <p class="text-xs text-gray-500 truncate" title="${item.name}">${item.name}</p>
                    </div>
                `;
                gallery.appendChild(card);
            });
        }

        function updateUI() {
            downloadBtn.disabled = filesData.length === 0;
            const emptyText = document.getElementById('emptyState');
            
            if (filesData.length === 0) {
                emptyText.classList.remove('hidden');
                dropZone.classList.remove('hidden');
                // Make dropzone bigger when empty
                dropZone.classList.add('py-20');
                dropZone.classList.remove('py-8');
            } else {
                emptyText.classList.add('hidden');
                // Make dropzone smaller/compact when items exist
                dropZone.classList.add('py-8');
                dropZone.classList.remove('py-20');
            }
        }

        function showToast(message) {
            toastMsg.innerText = message;
            toast.classList.remove('translate-y-20');
            setTimeout(() => {
                toast.classList.add('translate-y-20');
            }, 3000);
        }

        // --- PPTX GENERATION LOGIC ---

        async function generatePPTX() {
            if (filesData.length === 0) return;

            loader.classList.remove('hidden');

            try {
                // Initialize PptxGenJS
                let pres = new PptxGenJS();
                
                // 16:9 Aspect Ratio (Widescreen)
                pres.layout = 'LAYOUT_16x9'; 

                // Process files sequentially
                for (let i = 0; i < filesData.length; i++) {
                    const fileData = filesData[i];
                    const base64 = await fileToBase64(fileData.file);
                    
                    let slide = pres.addSlide();
                    
                    // Add Image: fitting logic
                    // We set w/h to '100%' to cover the slide.
                    slide.addImage({ 
                        data: base64, 
                        x: 0, 
                        y: 0, 
                        w: '100%', 
                        h: '100%' 
                    });
                }

                // Generate and Download
                await pres.writeFile({ fileName: "My_Presentation.pptx" });
                showToast("Presentation downloaded!");

            } catch (error) {
                console.error(error);
                alert("Error generating presentation. Please try again.");
            } finally {
                loader.classList.add('hidden');
            }
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }
    </script>
</body>
</html>
